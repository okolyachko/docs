<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex/" /><link rel="search" title="Search" href="../../../search/" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Query API | Alan Docs</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    


<style>
  :root {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/algolia.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@latest/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b">
    <link rel="shortcut icon" type="image/x-icon" href="../../../_static/favicon.ico">
	<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
	<link rel="canonical" href="https://alan.app/docs/server-api/question-answering/query-api/"/>
    <script type="text/javascript" src= "https://studio.alan.app/web/lib/alan_lib.min.js"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-QTCQV2T397"></script>
        <script>
        	window.dataLayer = window.dataLayer || [];
        	function gtag(){dataLayer.push(arguments);}
        	gtag('js', new Date());
		
        	gtag('config', window.location.hostname === "alan.app" ? 'G-QTCQV2T397' : 'G-H4F9QS7RMX');
	</script>
</head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="-5 -3 24 24"
      stroke="currentColor"
      class="feather feather-chevron-right">
      <path d="M11 9l-6 5.25V3.75z"></path>
    </svg>
  </symbol>
</svg>


    <link rel="shortcut icon" type="image/x-icon" href="../../../_static/favicon.ico">
	<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
	<link rel="canonical" href="https://alan.app/docs/server-api/question-answering/query-api/"/>
    <script type="text/javascript" src= "https://studio.alan.app/web/lib/alan_lib.min.js"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-QTCQV2T397"></script>
        <script>
        	window.dataLayer = window.dataLayer || [];
        	function gtag(){dataLayer.push(arguments);}
        	gtag('js', new Date());
		
        	gtag('config', window.location.hostname === "alan.app" ? 'G-QTCQV2T397' : 'G-H4F9QS7RMX');
	</script>



<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>


<div class="header-new">
<div class="header-content">
		<div class="logo-part">
			<div class="logo"> 
			
             <div class="sidebar-logo-container">
				<a href="https://alan.app"><img class="sidebar-logo" src="../../../_static/alan-logo.svg" alt="Logo"/></a>
				<div class="docs">
					
					<a href="../../../"> 
					
					</div>
				</div>
			
			</div>
			
			
			</a>
		</div>
        
		
		<div class="right-block">
		
		<!--<div class="dropdown" id="version">
		  <button class="dropbtn">4.2</button><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i>
		  <div id="myDropdown" class="dropdown-content">
			<a href="javascript:void(0);" class="drop-link">4.2</a>
			<a href="javascript:void(0);" class="drop-link">4.1</a>
			<a href="javascript:void(0);" class="drop-link">3.x</a>
		  </div>
		</div>
		
		<div class="dropdown" id="platform">
		  <button class="dropbtn">Framework/language</button><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i>
		  <div id="myDropdown" class="dropdown-content">
			<a href="javascript:void(0);" class="drop-link">Web (React, Angular, etc.)</a>
			<a href="javascript:void(0);" class="drop-link">Objective-C</a>
			<a href="javascript:void(0);" class="drop-link">Swift</a>
			<a href="javascript:void(0);" class="drop-link">Kotlin</a>
			<a href="javascript:void(0);" class="drop-link">Java</a>
			<a href="javascript:void(0);" class="drop-link">Flutter</a>
			<a href="javascript:void(0);" class="drop-link">Ionic</a>
			<a href="javascript:void(0);" class="drop-link">React Native</a>
		  </div>
		</div>-->
		
		<!-- First Dropdown -->
		<div class="dropdown" id="version">
			<button class="dropbtn">Version</button>
			<div class="dropdown-content">
				<a href="javascript:void(0);">4.2</a>
				<a href="javascript:void(0);">4.1</a>
				<a href="javascript:void(0);">3.x</a>
			</div>
		</div>

		<!-- Second Dropdown -->
		<div class="dropdown" id="platform">
			<button class="dropbtn">Framework/language</button>
			<div class="dropdown-content">
				<a href="javascript:void(0);">Web (React, Angular, etc.)</a>
				<a href="javascript:void(0);">Objective-C</a>
				<a href="javascript:void(0);">Swift</a>
				<a href="javascript:void(0);">Kotlin</a>
				<a href="javascript:void(0);">Java</a>
				<a href="javascript:void(0);">Flutter</a>
				<a href="javascript:void(0);">Ionic</a>
				<a href="javascript:void(0);">React Native</a>

			</div>
		</div>
		
		
		<div class="goto"><a class="docs-tooltip-link" target="_blank"></a>
		<span class="docs-tooltip">Go to docs</span>
		</div>
		
		<div class="search-box">   
			<form class="sidebar-search-container" >
				<input class="sidebar-search" placeholder=Search name="q" ={sendRequestDebounce}>
				<input type="hidden" name="check_keywords" value="yes">
				<input type="hidden" name="area" value="default">
			</form>
			
			
		</div>
		<div class="social">
			<a href="https://alanaigroup.slack.com/join/shared_invite/enQtNzMzOTE5MTIwMjg4LWI4ZmM4MTNkMTdmY2M0ZWEwODlmZDQ5Y2ZkMjUzNmMyZDJiMzA0Y2M1NDdhYzZjYWFlZTA5NjM4OTU0MWFmNWU#/shared-invite/email" target="_blank" class="fa-brands fa-slack fa-lg"></a>
			<a href="https://github.com/alan-ai" target="_blank" class="fa-brands fa-github fa-lg"></a>
        </div>
		</div>
		</div>
    </div>

	  
		
		
	
	</div>
<div class="page">
  
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <div class="logo-part">
			<div class="logo"> 
			
             <div class="sidebar-logo-container">
				<a href="https://alan.app"><img class="sidebar-logo" src="../../../_static/alan-logo.svg" alt="Logo"/></a>
			</div>
			
			</div>
			
			<div class="docs">
			
			<a href="../../../"> 
			
			</div>
			</a>
		</div>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../contents/">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/alan-logo.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container">
  <input class="sidebar-search search-mobile" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../">Get started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../usage/how-works/about/">How Alan AI works</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/how-works/basics/">Alan AI basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/how-works/infrastructure/">Alan AI infrastructure</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/how-works/deployment/">Deployment options</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/how-works/cloud-deployment/">Cloud deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/how-works/hybrid-deployment/">Hybrid deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/how-works/on-premises-deployment/">On-premises deployment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/how-works/voice-processing/">Voice processing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../usage/guides/studio/">Alan AI Studio</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/projects/">Alan AI projects</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/guides/scripts/">Dialog scripts</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/managing-scripts/">Managing scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/importing-scripts/">Exporting and importing scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/sharing-github/">Sharing and keeping scripts in GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/using-shortcuts/">Using shortcuts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/changing-theme/">Changing the theme and font size</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/viewing-flowchart/">Viewing the script flowchart</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/versioning/">Versions and environments</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/guides/script-testing/">Testing and debugging</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/debugging-chat/">Debugging Chat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/studio-test-tools/">Tools to simulate in-app behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/test-view/">Test View</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/logs/">Alan AI Studio logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/in-app-testing/">In-app testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/playground/">Alan AI Playground</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/guides/analytics/">Conversational analytics</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/dashboard/">Projects dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/analytics-view/">Analytics View</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/billing/">Billing and subscriptions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../usage/button/overview/">Alan AI assistant</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/customization/">Customizing the AI assistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/chat/">Enabling the Alan AI Chat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/cohorts/">Setting up cohorts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/activation/">Starting and stopping dialog sessions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/additional/supported-platforms/">Supported platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/additional/library/">Alan AI resource library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/updates/">Recent Alan AI Platform updates</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="query-api">
<h1>Query API<a class="headerlink" href="#query-api" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">query</span> <span class="pre">API</span></code> is available in SLU v4.1 or later.</p>
</div>
<p>In some cases, it may be necessary to retrieve a response generated by your AI assistant to use it further in the dialog logic. For example, you may need to get the information the user requests and save it to a file, send it by email and so on.</p>
<p>Alan AI provides the <code class="docutils literal notranslate"><span class="pre">query</span> <span class="pre">API</span></code> to query corpus data programmatically. The <code class="docutils literal notranslate"><span class="pre">query</span> <span class="pre">API</span></code> can be helpful for:</p>
<ul class="simple">
<li><p>Education and training</p></li>
<li><p>Data analysis</p></li>
<li><p>Reporting and so on</p></li>
</ul>
<p>To query corpus data programmatically, add <code class="docutils literal notranslate"><span class="pre">api.query_v1()</span></code> to the dialog script. The <code class="docutils literal notranslate"><span class="pre">query</span> <span class="pre">API</span></code> takes two parameters:</p>
<ul class="simple">
<li><p>Data corpus against which the query is run</p></li>
<li><p>Question to be asked</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Dialog script</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-alan notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">text = </span><span class="kp">corpus</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">    My name is Alan</span>
<span class="sb">`</span><span class="p">)</span>

<span class="kp">intent</span><span class="p">(</span><span class="s1">'Answer my question'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">p</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">answer = </span><span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">query_v1</span><span class="p">({</span><span class="kp">corpus</span><span class="o">:</span> <span class="nx">text</span><span class="p">,</span> <span class="nv">question: </span><span class="s2">"What is your name?"</span><span class="p">});</span>
    <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'Here you go'</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">answer</span><span class="p">.</span><span class="nx">summary</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="examples-of-use">
<h2>Examples of use<a class="headerlink" href="#examples-of-use" title="Permalink to this headline">¶</a></h2>
<div class="tabbed-set docutils">
<input checked="checked" id="3c30b13b-deb7-4d16-a51b-906b51f156f2" name="e7a8caad-6b95-4ca1-a0ff-f3988433b456" type="radio"/>
<label class="tabbed-label" for="3c30b13b-deb7-4d16-a51b-906b51f156f2">
Text corpus</label><div class="tabbed-content docutils">
<p>Let’s assume you want to get an answer to a question from the FAQ data you have in plain text. For this, you can add the following code to the dialog script:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Dialog script</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-alan notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">FAQ = </span><span class="kp">corpus</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">    Where can I sell with Shopify? Shopify lets you sell almost anywhere your customers are, including online, in-person, online marketplaces, and social media.</span>
<span class="sb">    What happens when I receive an order? Depending on your preferences, you’ll receive an email, mobile app notification, or RSS notification every time your receive an order.</span>
<span class="sb">    Do I need to ship items myself? No, you don’t need to ship items yourself. You can use a third-party fulfilment service to prepare and ship your orders for you.</span>
<span class="sb">`</span><span class="p">);</span>

<span class="kp">intent</span><span class="p">(</span><span class="s2">"$(QUERY* .+)"</span><span class="p">,</span> <span class="k">async</span> <span class="nx">p</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">answer = </span><span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">query_v1</span><span class="p">({</span><span class="kp">corpus</span><span class="o">:</span> <span class="nx">FAQ</span><span class="p">,</span> <span class="nv">question: </span><span class="k k-Alan">p.</span><span class="nx">QUERY</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">answer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="nx">answer</span><span class="p">);</span>
        <span class="kd">let</span> <span class="kr">final</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">answer</span><span class="p">.</span><span class="nx">gather</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="kr">final</span><span class="p">.</span><span class="nx">summary</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="kr">final</span><span class="p">.</span><span class="nx">answer</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="sb">`Sorry, I cannot help you with that`</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>Here, the corpus data is saved to <code class="docutils literal notranslate"><span class="pre">FAQ</span></code>. The user question is captured with the <code class="docutils literal notranslate"><span class="pre">QUERY</span></code> slot and then passed to <code class="docutils literal notranslate"><span class="pre">api.query_v1</span></code> together with the corpus data. To get the answer, the <code class="docutils literal notranslate"><span class="pre">gather()</span></code> method is used that collects the final response. The result is then written to Alan Studio logs.</p>
</div>
<input id="d545d884-c1c5-4b0b-93bf-6c8e2d4a3267" name="e7a8caad-6b95-4ca1-a0ff-f3988433b456" type="radio"/>
<label class="tabbed-label" for="d545d884-c1c5-4b0b-93bf-6c8e2d4a3267">
Web corpus</label><div class="tabbed-content docutils">
<p>Let’s assume you want to get an answer to a question from the FAQ data published in a web page. For this, you can add the following code to the dialog script:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Dialog script</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-alan notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">FAQ = </span><span class="kp">corpus</span><span class="p">({</span><span class="nv">url: </span><span class="s2">"https://www.shopify.com/faq"</span><span class="p">,</span> <span class="nv">depth: </span><span class="mf">1</span><span class="p">,</span> <span class="nv">maxPages: </span><span class="mf">10</span><span class="p">});</span>

<span class="kp">intent</span><span class="p">(</span><span class="sb">`$(QUERY* .+)`</span><span class="p">,</span> <span class="k">async</span> <span class="nx">p</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">query = </span><span class="k k-Alan">p.</span><span class="nx">QUERY</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nv">answer = </span><span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">query_v1</span><span class="p">({</span><span class="kp">corpus</span><span class="o">:</span> <span class="nx">FAQ</span><span class="p">,</span> <span class="nv">question: </span><span class="nx">query</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">answer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="nx">answer</span><span class="p">);</span>
        <span class="kd">let</span> <span class="kr">final</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">answer</span><span class="p">.</span><span class="nx">gather</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="kr">final</span><span class="p">.</span><span class="nx">summary</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="kr">final</span><span class="p">.</span><span class="nx">answer</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="sb">`Sorry, I cannot help you with that`</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>Here, the corpus data is saved to <code class="docutils literal notranslate"><span class="pre">FAQ</span></code>. The user question is captured with the <code class="docutils literal notranslate"><span class="pre">QUERY</span></code> slot and then passed to <code class="docutils literal notranslate"><span class="pre">api.query_v1</span></code> together with the corpus data. To get the answer, the <code class="docutils literal notranslate"><span class="pre">gather()</span></code> method is used that collects the final response. The result is then written to Alan Studio logs.</p>
<p>You can ask questions covered by the FAQ page, for example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">What</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">merchant</span> <span class="pre">account?</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">How</span> <span class="pre">can</span> <span class="pre">I</span> <span class="pre">dropship</span> <span class="pre">with</span> <span class="pre">Shopify?</span></code></p></li>
</ul>
</div>
<input id="5ef4c8a7-b241-4364-9e5d-d93abed4d95a" name="e7a8caad-6b95-4ca1-a0ff-f3988433b456" type="radio"/>
<label class="tabbed-label" for="5ef4c8a7-b241-4364-9e5d-d93abed4d95a">
Answer transforming</label><div class="tabbed-content docutils">
<p>In some cases, you may need to present answers from the Q&amp;A services transformed and formatted in a specific way. To do this, you can utilize the <code class="docutils literal notranslate"><span class="pre">transforms()</span></code> function in Alan AI. The <code class="docutils literal notranslate"><span class="pre">transforms()</span></code> function allows you to pre-process and transform input data using the templates and rules that you define. For details, see <a class="reference internal" href="../../transforms/overview/"><span class="doc">Data transformation</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The transforms functionality is available in SLU 4.2 and later.</p>
</div>
<p>Let’s assume you want to display all answers using the following format:</p>
<p><strong>Question</strong></p>
<p>User query</p>
<p><strong>Answer</strong></p>
<p>Answer from FAQ</p>
<p><strong>Steps to take</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://accounts.shopify.com/">Start a free trial</a></p></li>
<li><p><a class="reference external" href="https://accounts.shopify.com/">Log in</a></p></li>
</ul>
<p>For that, do the following:</p>
<ol class="arabic">
<li><p>Add a transform named <code class="docutils literal notranslate"><span class="pre">format</span></code> with the following rules:</p>
<p><strong>Example 1</strong></p>
<ul>
<li><p><strong>Common prompt</strong>: <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">input</span> <span class="pre">contains</span> <span class="pre">the</span> <span class="pre">initial</span> <span class="pre">response</span> <span class="pre">provided</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">AI</span> <span class="pre">assistant,</span> <span class="pre">the</span> <span class="pre">query</span> <span class="pre">contains</span> <span class="pre">a</span> <span class="pre">sample</span> <span class="pre">question,</span> <span class="pre">the</span> <span class="pre">result</span> <span class="pre">shows</span> <span class="pre">how</span> <span class="pre">the</span> <span class="pre">text</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">formatted</span></code></p></li>
<li><p><strong>Input</strong>: <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">merchant</span> <span class="pre">account</span> <span class="pre">is</span> <span class="pre">an</span> <span class="pre">account</span> <span class="pre">where</span> <span class="pre">your</span> <span class="pre">money</span> <span class="pre">is</span> <span class="pre">deposited</span> <span class="pre">after</span> <span class="pre">your</span> <span class="pre">customers’</span> <span class="pre">payments</span> <span class="pre">have</span> <span class="pre">been</span> <span class="pre">authorized</span> <span class="pre">and</span> <span class="pre">processed.</span> <span class="pre">It</span> <span class="pre">is</span> <span class="pre">used</span> <span class="pre">to</span> <span class="pre">accept</span> <span class="pre">payments</span> <span class="pre">from</span> <span class="pre">customers</span> <span class="pre">and</span> <span class="pre">is</span> <span class="pre">typically</span> <span class="pre">provided</span> <span class="pre">by</span> <span class="pre">a</span> <span class="pre">third-party</span> <span class="pre">payment</span> <span class="pre">processor</span> <span class="pre">(also</span> <span class="pre">known</span> <span class="pre">as</span> <span class="pre">a</span> <span class="pre">payment</span> <span class="pre">provider</span> <span class="pre">or</span> <span class="pre">payment</span> <span class="pre">gateway).</span> <span class="pre">The</span> <span class="pre">payment</span> <span class="pre">processor</span> <span class="pre">will</span> <span class="pre">authorize</span> <span class="pre">and</span> <span class="pre">process</span> <span class="pre">the</span> <span class="pre">payments</span> <span class="pre">and</span> <span class="pre">then</span> <span class="pre">deposit</span> <span class="pre">the</span> <span class="pre">funds</span> <span class="pre">into</span> <span class="pre">the</span> <span class="pre">merchant</span> <span class="pre">account.</span></code>, input format: <strong>text</strong></p></li>
<li><p><strong>Query</strong>: <code class="docutils literal notranslate"><span class="pre">What</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">merchant</span> <span class="pre">account?</span></code></p></li>
<li><p><strong>Result</strong>: example of output data, output format: <strong>markdown</strong>:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Result field</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gs">**Question**</span>:

What is a merchant account?

<span class="gs">**Answer**</span>:

A merchant account is an account where your money is deposited after your customers’ payments have been authorized and processed. It is used to accept payments from customers and is typically provided by a third-party payment processor (also known as a payment provider or payment gateway). The payment processor will authorize and process the payments and then deposit the funds into the merchant account.

<span class="gs">**Steps to take**</span>

<span class="k">-</span><span class="w"> </span>[<span class="nt">Start a free trial</span>](<span class="na">https://accounts.shopify.com/</span>)
<span class="k">-</span><span class="w"> </span>[<span class="nt">Log in</span>](<span class="na">https://accounts.shopify.com/</span>)
</pre></div>
</div>
</div>
</li>
</ul>
<p><strong>Example 2</strong></p>
<ul>
<li><p><strong>Common prompt</strong>: <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">input</span> <span class="pre">contains</span> <span class="pre">the</span> <span class="pre">initial</span> <span class="pre">response</span> <span class="pre">provided</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">AI</span> <span class="pre">assistant,</span> <span class="pre">the</span> <span class="pre">query</span> <span class="pre">contains</span> <span class="pre">a</span> <span class="pre">sample</span> <span class="pre">question,</span> <span class="pre">the</span> <span class="pre">result</span> <span class="pre">shows</span> <span class="pre">how</span> <span class="pre">the</span> <span class="pre">text</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">formatted</span></code></p></li>
<li><p><strong>Input</strong>: <code class="docutils literal notranslate"><span class="pre">No,</span> <span class="pre">you</span> <span class="pre">don’t</span> <span class="pre">need</span> <span class="pre">to</span> <span class="pre">ship</span> <span class="pre">items</span> <span class="pre">yourself.</span> <span class="pre">You</span> <span class="pre">can</span> <span class="pre">use</span> <span class="pre">a</span> <span class="pre">third-party</span> <span class="pre">fulfilment</span> <span class="pre">service</span> <span class="pre">to</span> <span class="pre">prepare</span> <span class="pre">and</span> <span class="pre">ship</span> <span class="pre">your</span> <span class="pre">orders</span> <span class="pre">for</span> <span class="pre">you.</span></code>, input format: <strong>text</strong></p></li>
<li><p><strong>Query</strong>: <code class="docutils literal notranslate"><span class="pre">Do</span> <span class="pre">I</span> <span class="pre">need</span> <span class="pre">to</span> <span class="pre">ship</span> <span class="pre">items</span> <span class="pre">myself?</span></code></p></li>
<li><p><strong>Result</strong>: example of output data, output format: <strong>markdown</strong>:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Result field</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gs">**Question**</span>:

Do I need to ship items myself?

<span class="gs">**Answer**</span>:

No, you don’t need to ship items yourself. You can use a third-party fulfilment service to prepare and ship your orders for you.

<span class="gs">**Steps to take**</span>

<span class="k">-</span><span class="w"> </span>[<span class="nt">Start a free trial</span>](<span class="na">https://accounts.shopify.com/</span>)
<span class="k">-</span><span class="w"> </span>[<span class="nt">Log in</span>](<span class="na">https://accounts.shopify.com/</span>)
</pre></div>
</div>
</div>
</li>
</ul>
<img alt="../../../_images/query-api-transforms.png" src="../../../_images/query-api-transforms.png"/>
</li>
<li><p>Add the following code to your dialog script:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Dialog script</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-alan notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">FAQ = </span><span class="kp">corpus</span><span class="p">({</span><span class="nv">url: </span><span class="s2">"https://www.shopify.com/faq"</span><span class="p">,</span> <span class="nv">depth: </span><span class="mf">1</span><span class="p">,</span> <span class="nx">maxPages</span><span class="o">:</span><span class="mf">10</span><span class="p">});</span>

<span class="kp">intent</span><span class="p">(</span><span class="sb">`$(QUERY* .+)`</span><span class="p">,</span> <span class="k">async</span> <span class="nx">p</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">query = </span><span class="k k-Alan">p.</span><span class="nx">QUERY</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nv">answer = </span><span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">query_v1</span><span class="p">({</span><span class="kp">corpus</span><span class="o">:</span> <span class="nx">FAQ</span><span class="p">,</span> <span class="nv">question: </span><span class="nx">query</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">answer</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="kr">final</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">answer</span><span class="p">.</span><span class="nx">gather</span><span class="p">();</span>
        <span class="kd">let</span> <span class="nv">formattedAnswer = </span><span class="k">await</span> <span class="nx">transforms</span><span class="p">.</span><span class="nx">format</span><span class="p">({</span>
            <span class="nv">input: </span><span class="kr">final</span><span class="p">,</span>
            <span class="nv">query: </span><span class="nx">query</span>
        <span class="p">});</span>
        <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="nx">formattedAnswer</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="sb">`Sorry, I cannot help you with that`</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</li>
</ol>
<p>Here, the corpus data is saved to <code class="docutils literal notranslate"><span class="pre">FAQ</span></code>. The user question is captured with the <code class="docutils literal notranslate"><span class="pre">QUERY</span></code> slot and then passed to <code class="docutils literal notranslate"><span class="pre">api.query_v1</span></code> together with the corpus data. The answer obtained from the Query API is then formatted using the rules defined in the <code class="docutils literal notranslate"><span class="pre">format</span></code> transform and displayed in the Alan AI Chat:</p>
<img alt="../../../_images/query-api-transforms-example.png" src="../../../_images/query-api-transforms-example.png"/>
</div>
</div>
<div id="green-background"></div></div>
</div>

      </article>
	  <div class="alan-btn"></div>
	  <script>
		function isLocalStorageAvailable() {
            var result;

            try {
                localStorage.setItem('test', 1);
                localStorage.getItem('test');
                localStorage.removeItem('test');
                result = true;
            } catch (e) {
                result = false;
            }
            return result;
        }

        function getProjectId() {
            var key = 'beae1a6e1f7e512c4d0bf347580da6fd2e956eca572e1d8b807a3e2338fdd0dc/prod';
            if (key) {
                return key.substr(0, key.indexOf('/'));
            }

            return null;
        }

        console.info("Alan Lib is laoded.");
        window.alanBtnInstance = window.alanBtn({
            key: 'beae1a6e1f7e512c4d0bf347580da6fd2e956eca572e1d8b807a3e2338fdd0dc/prod',
            zIndex: 999999,
            onCommand: function (commandData) {

                if (commandData && commandData.command === 'openURL') {
                    if (commandData.target === '_blank'){
                        window.open(commandData.url,'_newtab' + Math.floor(Math.random()*999999));
                    } else {
                        window.location.href = commandData.url;
                    }

                }
            },
            onConnectionStatus: function (status) {
                if (status === 'authorized') {
                    window.alanBtnInstance.setVisualState({ page: window.location.pathname, url: window.location.href });
                    if(isLocalStorageAvailable()){
                        if(!localStorage.getItem('alan-btn-session-'+ getProjectId())) {
                            localStorage.setItem('alan-btn-session-'+ getProjectId(), 1)
                            window.alanBtnInstance.callProjectApi("sendGreetingMessage");
                        }
                    }
                }
            },
        });
	  </script>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        
	  <div class="alan-footer">
	  <div class="footer-logo-and-social-icons">
		<div class="footer-logo-and-text">
		<a class="footer-logo" aria-label="Link to alan.app" href="https://alan.app/"></a>
		</div>
		<div class="footer-text">
		<span>Alan AI<sup>®</sup> is a trademark of Alan AI, Inc.</span>
		<span>Handcrafted in Sunnyvale, California</span>
		</div>
		<div class="footer-other">
		<div class="footer-social">
			<a href="https://twitter.com/alanvoiceai" target="_blank" class="fa-brands fa-twitter"></a>
			<a href="http://linkedin.com/company/alanvoiceai" target="_blank" class="fa-brands fa-linkedin"></a>
			<a href="https://www.facebook.com/alanvoiceai/" target="_blank" class="fa-brands fa-facebook"></a>
			<a href="https://www.instagram.com/alanvoiceai/" target="_blank" class="fa-brands fa-instagram"></a>
			<a href="https://www.youtube.com/channel/UCrsg0b32nL6L2j5jG7uxOuw" target="_blank" class="fa-brands fa-youtube"></a>
			<a href="https://alanaigroup.slack.com/join/shared_invite/enQtNzMzOTE5MTIwMjg4LWI4ZmM4MTNkMTdmY2M0ZWEwODlmZDQ5Y2ZkMjUzNmMyZDJiMzA0Y2M1NDdhYzZjYWFlZTA5NjM4OTU0MWFmNWU#/shared-invite/email" target="_blank" class="fa-brands fa-slack"></a>
			<a href="https://github.com/alan-ai" target="_blank" class="fa-brands fa-github"></a>
        </div>
		</div>
	  </div>
	  <div class="footer-badges">
	  <div class="footer-badges-info">
	  <div class="footer-badges-info-icon"></div>
	  <div>Download Alan Playground to see how Conversational Voice Experiences can add value to your application or test your Alan Studio Projects.</div>
	  </div>
	  
	  </div>
	  <div class="footer-badges-imgs">
	  <a class="footer_badges_imgs_app-store" href="https://apps.apple.com/ca/app/alan-playground/id1474478921"></a>
	  <a class="footer_badges_imgs_google-play" href="https://play.google.com/store/apps/details?id=app.alan.playground"></a>
	  </div>
	  
	  </div>
	  
      </footer>
	
    </div>
	
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Query API</a><ul>
<li><a class="reference internal" href="#examples-of-use">Examples of use</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  
  </main>
</div>
</div>

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/custom.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@latest/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/scripts/algolia.js"></script>
    <script defer="defer" src="../../../_static/scripts/algolia-mobile.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>