<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex/" /><link rel="search" title="Search" href="../../../search/" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Passing the app state to the dialog script (Flutter) | Alan Docs</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    


<style>
  :root {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/algolia.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@latest/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b">
    <link rel="shortcut icon" type="image/x-icon" href="../../../_static/favicon.ico">
	<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
	<link rel="canonical" href="https://alan.app/docs/tutorials/flutter/sending-data-flutter/"/>
    <script type="text/javascript" src= "https://studio.alan.app/web/lib/alan_lib.min.js"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-QTCQV2T397"></script>
        <script>
        	window.dataLayer = window.dataLayer || [];
        	function gtag(){dataLayer.push(arguments);}
        	gtag('js', new Date());
		
        	gtag('config', window.location.hostname === "alan.app" ? 'G-QTCQV2T397' : 'G-H4F9QS7RMX');
	</script>
</head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="-5 -3 24 24"
      stroke="currentColor"
      class="feather feather-chevron-right">
      <path d="M11 9l-6 5.25V3.75z"></path>
    </svg>
  </symbol>
</svg>


    <link rel="shortcut icon" type="image/x-icon" href="../../../_static/favicon.ico">
	<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
	<link rel="canonical" href="https://alan.app/docs/tutorials/flutter/sending-data-flutter/"/>
    <script type="text/javascript" src= "https://studio.alan.app/web/lib/alan_lib.min.js"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-QTCQV2T397"></script>
        <script>
        	window.dataLayer = window.dataLayer || [];
        	function gtag(){dataLayer.push(arguments);}
        	gtag('js', new Date());
		
        	gtag('config', window.location.hostname === "alan.app" ? 'G-QTCQV2T397' : 'G-H4F9QS7RMX');
	</script>



<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>


<div class="header-new">
<div class="header-content">
		<div class="logo-part">
			<div class="logo"> 
			
             <div class="sidebar-logo-container">
				<a href="https://alan.app"><img class="sidebar-logo" src="../../../_static/alan-logo.svg" alt="Logo"/></a>
				<div class="docs">
					
					<a href="../../../"> 
					
					</div>
				</div>
			
			</div>
			
			
			</a>
		</div>
        
		
		<div class="right-block">
		
		<!--<div class="dropdown" id="version">
		  <button class="dropbtn">4.2</button><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i>
		  <div id="myDropdown" class="dropdown-content">
			<a href="javascript:void(0);" class="drop-link">4.2</a>
			<a href="javascript:void(0);" class="drop-link">4.1</a>
			<a href="javascript:void(0);" class="drop-link">3.x</a>
		  </div>
		</div>
		
		<div class="dropdown" id="platform">
		  <button class="dropbtn">Framework/language</button><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i>
		  <div id="myDropdown" class="dropdown-content">
			<a href="javascript:void(0);" class="drop-link">Web (React, Angular, etc.)</a>
			<a href="javascript:void(0);" class="drop-link">Objective-C</a>
			<a href="javascript:void(0);" class="drop-link">Swift</a>
			<a href="javascript:void(0);" class="drop-link">Kotlin</a>
			<a href="javascript:void(0);" class="drop-link">Java</a>
			<a href="javascript:void(0);" class="drop-link">Flutter</a>
			<a href="javascript:void(0);" class="drop-link">Ionic</a>
			<a href="javascript:void(0);" class="drop-link">React Native</a>
		  </div>
		</div>-->
		
		<!-- First Dropdown -->
		<div class="dropdown" id="version">
			<button class="dropbtn">Version</button>
			<div class="dropdown-content">
				<a href="javascript:void(0);">4.2</a>
				<a href="javascript:void(0);">4.1</a>
				<a href="javascript:void(0);">3.x</a>
			</div>
		</div>

		<!-- Second Dropdown -->
		<div class="dropdown" id="platform">
			<button class="dropbtn">Framework/language</button>
			<div class="dropdown-content">
				<a href="javascript:void(0);">Web (React, Angular, etc.)</a>
				<a href="javascript:void(0);">Objective-C</a>
				<a href="javascript:void(0);">Swift</a>
				<a href="javascript:void(0);">Kotlin</a>
				<a href="javascript:void(0);">Java</a>
				<a href="javascript:void(0);">Flutter</a>
				<a href="javascript:void(0);">Ionic</a>
				<a href="javascript:void(0);">React Native</a>

			</div>
		</div>
		
		
		<div class="goto"><a class="docs-tooltip-link" target="_blank"></a>
		<span class="docs-tooltip">Go to docs</span>
		</div>
		
		<div class="search-box">   
			<form class="sidebar-search-container" >
				<input class="sidebar-search" placeholder=Search name="q" ={sendRequestDebounce}>
				<input type="hidden" name="check_keywords" value="yes">
				<input type="hidden" name="area" value="default">
			</form>
			
			
		</div>
		<div class="social">
			<a href="https://alanaigroup.slack.com/join/shared_invite/enQtNzMzOTE5MTIwMjg4LWI4ZmM4MTNkMTdmY2M0ZWEwODlmZDQ5Y2ZkMjUzNmMyZDJiMzA0Y2M1NDdhYzZjYWFlZTA5NjM4OTU0MWFmNWU#/shared-invite/email" target="_blank" class="fa-brands fa-slack fa-lg"></a>
			<a href="https://github.com/alan-ai" target="_blank" class="fa-brands fa-github fa-lg"></a>
        </div>
		</div>
		</div>
    <div class="version-note"><p>You are viewing the documentation for an earlier version of the Alan AI Platform.</p></div>	
	</div>

	  
		
		
	
	</div>
<div class="page">
  
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <div class="logo-part">
			<div class="logo"> 
			
             <div class="sidebar-logo-container">
				<a href="https://alan.app"><img class="sidebar-logo" src="../../../_static/alan-logo.svg" alt="Logo"/></a>
			</div>
			
			</div>
			
			<div class="docs">
			
			<a href="../../../"> 
			
			</div>
			</a>
		</div>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../contents/">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/alan-logo.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container">
  <input class="sidebar-search search-mobile" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../">Get started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../usage/how-works/about/">How Alan AI works</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/how-works/basics/">Alan AI basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/how-works/infrastructure/">Alan AI infrastructure</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/how-works/deployment/">Deployment options</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/how-works/cloud-deployment/">Cloud deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/how-works/hybrid-deployment/">Hybrid deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/how-works/on-premises-deployment/">On-premises deployment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/how-works/voice-processing/">Voice processing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../usage/guides/studio/">Alan AI Studio</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/projects/">Alan AI projects</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/guides/scripts/">Dialog scripts</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/managing-scripts/">Managing scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/importing-scripts/">Exporting and importing scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/sharing-github/">Sharing and keeping scripts in GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/using-shortcuts/">Using shortcuts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/changing-theme/">Changing the theme and font size</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/viewing-flowchart/">Viewing the script flowchart</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/versioning/">Versions and environments</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/guides/script-testing/">Testing and debugging</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/debugging-chat/">Debugging Chat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/studio-test-tools/">Tools to simulate in-app behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/test-view/">Test View</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/logs/">Alan AI Studio logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/in-app-testing/">In-app testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/playground/">Alan AI Playground</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../usage/guides/analytics/">Conversational analytics</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/dashboard/">Projects dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/guides/analytics-view/">Analytics View</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/guides/billing/">Billing and subscriptions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../usage/button/overview/">Alan AI assistant</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/customization/">Customizing the AI assistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/chat/">Enabling the Alan AI Chat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/cohorts/">Setting up cohorts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/button/activation/">Starting and stopping dialog sessions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/additional/supported-platforms/">Supported platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/additional/library/">Alan AI resource library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/updates/">Recent Alan AI Platform updates</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div id="orange-background"></div><div class="section" id="passing-the-app-state-to-the-dialog-script-flutter">
<h1>Passing the app state to the dialog script (Flutter)<a class="headerlink" href="#passing-the-app-state-to-the-dialog-script-flutter" title="Permalink to this headline">¶</a></h1>
<p>An important feature of a robust voice assistant is context awareness. To provide relevant responses to users, the voice assistant must know what is happening in the app: what screen is currently open, what
options are enabled and so on.</p>
<p>To get information about the app state, you can use <a class="reference internal" href="../../../server-api/sending-data/visual-state/"><span class="doc">Alan AI’s visual state
functionality</span></a>. The visual state allows you to send an arbitrary JSON object informing about the current app context to the dialog script. You can access this data in the
script through the <a class="reference internal" href="../../../server-api/objects/#visual"><span class="std std-ref">p.visual</span></a> runtime variable.</p>
<p>In this tutorial, we will let our voice assistant know what screen is currently open in the app. On the script side, we will use the passed state to do the following:</p>
<ul class="simple">
<li><p>Add a voice command that will let the AI assistant reply differently depending on the screen open in the app</p></li>
<li><p>Create screen-specific commands that can be matched only if the necessary screen is open</p></li>
</ul>
<div class="video admonition">
<p class="admonition-title">YouTube</p>
<p><span class="fa fa-youtube-play"></span>
If you are a visual learner, <a class="reference external" href="https://www.youtube.com/watch?v=aVQlgLVMSxk&amp;t=3s">watch this tutorial</a> on <a class="reference external" href="https://www.youtube.com/c/AlanAI">Alan AI YouTube Channel</a>.</p>
</div>
<div class="section" id="what-you-will-learn">
<h2>What you will learn<a class="headerlink" href="#what-you-will-learn" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>How to pass the app state from a Flutter app to the dialog script with the visual state</p></li>
<li><p>How to access the data passed with the visual state in the dialog script</p></li>
<li><p>How to filter intents by the app state</p></li>
</ul>
</div>
<div class="section" id="what-you-will-need">
<h2>What you will need<a class="headerlink" href="#what-you-will-need" title="Permalink to this headline">¶</a></h2>
<p>To go through this tutorial, make sure the following prerequisites are met:</p>
<ul class="simple">
<li><p>In this tutorial, we will continue using the Flutter app created in the previous tutorials. You can also use your own app with several screens. Make sure you have completed all steps from the previous tutorials:</p>
<ul>
<li><p><a class="reference internal" href="../integrating-flutter/"><span class="doc">Building a voice assistant for a Flutter app</span></a></p></li>
<li><p><a class="reference internal" href="../navigating-flutter/"><span class="doc">Navigating between screens in a Flutter app</span></a></p></li>
</ul>
</li>
<li><p>You have set up the Flutter environment and it is functioning properly. For details, see Flutter documentation.</p></li>
<li><p>The device on which you are planning to test drive the Flutter app is connected to the Internet. The Internet connection is required to let the Flutter app communicate with the dialog script run in the Alan AI Cloud.</p></li>
</ul>
</div>
<div class="section" id="step-1-add-routeobserver">
<h2>Step 1. Add RouteObserver<a class="headerlink" href="#step-1-add-routeobserver" title="Permalink to this headline">¶</a></h2>
<p>First, let’s add <a class="reference external" href="https://api.flutter.dev/flutter/widgets/RouteObserver-class.html">RouteObserver</a> to our app to keep track of screen transitions.</p>
<ol class="arabic">
<li><p>Register RouteObserver in the app and in the <code class="docutils literal notranslate"><span class="pre">MaterialApp</span></code> constructor:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">main.dart</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="c1">/// Register RouteObserver</span>
<span class="kd">final</span><span class="w"> </span><span class="n">RouteObserver</span><span class="o">&lt;</span><span class="n">PageRoute</span><span class="o">&gt;</span><span class="w"> </span><span class="n">routeObserver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RouteObserver</span><span class="o">&lt;</span><span class="n">PageRoute</span><span class="o">&gt;</span><span class="p">();</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MyApp</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">StatelessWidget</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">MaterialApp</span><span class="p">(</span>
<span class="w">      </span><span class="nl">title:</span><span class="w"> </span><span class="s1">'Flutter Demo'</span><span class="p">,</span>
<span class="w">      </span><span class="nl">theme:</span><span class="w"> </span><span class="n">ThemeData</span><span class="p">(</span>
<span class="w">        </span><span class="nl">primarySwatch:</span><span class="w"> </span><span class="n">Colors</span><span class="p">.</span><span class="n">blue</span><span class="p">,</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">      </span><span class="nl">home:</span><span class="w"> </span><span class="n">MyHomePage</span><span class="p">(</span><span class="nl">title:</span><span class="w"> </span><span class="s1">'Flutter Demo Home Page'</span><span class="p">),</span>
<span class="w">      </span><span class="c1">/// Register RouteObserver</span>
<span class="w">      </span><span class="nl">navigatorObservers:</span><span class="w"> </span><span class="p">[</span><span class="n">routeObserver</span><span class="p">],</span>
<span class="w">      </span><span class="nl">initialRoute:</span><span class="w"> </span><span class="s1">'/'</span><span class="p">,</span>
<span class="w">      </span><span class="nl">routes:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s1">'/second'</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SecondPage</span><span class="p">(),</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</li>
<li><p>Implement RouteAware in the second widget’s state and subscribe it to the RouteObserver:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">main.dart</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="c1">/// Implement RouteAware</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">_SecondPageState</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">State</span><span class="o">&lt;</span><span class="n">SecondPage</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="n">RouteAware</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">/// Subscribe to RouteObserver</span>
<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">didChangeDependencies</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">didChangeDependencies</span><span class="p">();</span>
<span class="w">    </span><span class="n">routeObserver</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">ModalRoute</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PageRoute</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">dispose</span><span class="p">(){</span>
<span class="w">    </span><span class="n">routeObserver</span><span class="p">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">didPush</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">didPop</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-2-send-the-app-state-to-the-dialog-script">
<h2>Step 2: Send the app state to the dialog script<a class="headerlink" href="#step-2-send-the-app-state-to-the-dialog-script" title="Permalink to this headline">¶</a></h2>
<p>Now we need to send information about the screen that is currently open in the app to the dialog script.</p>
<ol class="arabic">
<li><p>In the second widget’s state, add the <code class="docutils literal notranslate"><span class="pre">setVisuals()</span></code> function. Here we use the
<a class="reference internal" href="../../../client-api/methods/common-api/#setvisualstate"><span class="std std-ref">setVisualState()</span></a> client API method to pass the object containing information about the current screen.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">main.dart</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">setVisuals</span><span class="p">(</span><span class="kt">String</span><span class="w"> </span><span class="n">screen</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="n">visual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">screen</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="si">$</span><span class="n">screen</span><span class="se">\"</span><span class="s2">}"</span><span class="p">;</span>
<span class="w">  </span><span class="n">AlanVoice</span><span class="p">.</span><span class="n">setVisualState</span><span class="p">(</span><span class="n">visual</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">setVisuals()</span></code> in the <code class="docutils literal notranslate"><span class="pre">didPush()</span></code> and <code class="docutils literal notranslate"><span class="pre">didPop()</span></code> methods and pass the necessary screen name:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">main.dart</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="nd">@override</span>
<span class="kt">void</span><span class="w"> </span><span class="n">didPush</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">setVisuals</span><span class="p">(</span><span class="s2">"second"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@override</span>
<span class="kt">void</span><span class="w"> </span><span class="n">didPop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">setVisuals</span><span class="p">(</span><span class="s2">"first"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">_MyHomePageState</span></code>, add the <code class="docutils literal notranslate"><span class="pre">setVisuals()</span></code> function and call it to set the visual state when the first screen is initially open:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">main.dart</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nc">_MyHomePageState</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">State</span><span class="o">&lt;</span><span class="n">MyHomePage</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">initState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">initState</span><span class="p">();</span>
<span class="w">    </span><span class="n">WidgetsBinding</span><span class="p">.</span><span class="n">instance</span><span class="o">!</span><span class="p">.</span><span class="n">addPostFrameCallback</span><span class="p">((</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">setVisuals</span><span class="p">(</span><span class="s2">"first"</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">setVisuals</span><span class="p">(</span><span class="kt">String</span><span class="w"> </span><span class="n">screen</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">visual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">screen</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="si">$</span><span class="n">screen</span><span class="se">\"</span><span class="s2">}"</span><span class="p">;</span>
<span class="w">    </span><span class="n">AlanVoice</span><span class="p">.</span><span class="n">setVisualState</span><span class="p">(</span><span class="n">visual</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-3-add-a-voice-command-with-different-answers-for-screens">
<h2>Step 3: Add a voice command with different answers for screens<a class="headerlink" href="#step-3-add-a-voice-command-with-different-answers-for-screens" title="Permalink to this headline">¶</a></h2>
<p>Imagine we want to provide the user with a possibility to ask <code class="docutils literal notranslate"><span class="pre">What</span> <span class="pre">screen</span> <span class="pre">is</span> <span class="pre">this?</span></code> in the app, and the AI assistant must reply differently depending on the screen open. Let’s go back to Alan AI Studio and add a new intent to it:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Dialog script</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-alan notranslate"><div class="highlight"><pre><span></span><span class="kp">intent</span><span class="p">(</span><span class="sb">`What screen is this?`</span><span class="p">,</span> <span class="nx">p</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">screen = </span><span class="k k-Alan">p.</span><span class="kp">visual</span><span class="p">.</span><span class="nx">screen</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">screen</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s2">"first"</span><span class="o">:</span>
            <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'This is the first screen'</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">"second"</span><span class="o">:</span>
            <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'This is the second screen'</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'This is a voice-enabled Flutter app'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>Here we are using the <code class="docutils literal notranslate"><span class="pre">p.visual.screen</span></code> variable to access data passed with the visual state. Depending on the variable value, the AI assistant plays back different responses.</p>
<p>You can test it: run the app, say <code class="docutils literal notranslate"><span class="pre">Open</span> <span class="pre">the</span> <span class="pre">second</span> <span class="pre">screen</span></code> and ask: <code class="docutils literal notranslate"><span class="pre">What</span> <span class="pre">screen</span> <span class="pre">is</span> <span class="pre">this?</span></code> The AI assistant will get back with <code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">is</span> <span class="pre">the</span> <span class="pre">second</span> <span class="pre">screen</span></code>. Then say <code class="docutils literal notranslate"><span class="pre">Go</span> <span class="pre">back</span></code> and ask: <code class="docutils literal notranslate"><span class="pre">What</span> <span class="pre">screen</span> <span class="pre">is</span> <span class="pre">this?</span></code> The AI assistant will answer: <code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">is</span> <span class="pre">the</span> <span class="pre">first</span> <span class="pre">screen</span></code>.</p>
</div>
<div class="section" id="step-4-create-screen-specific-commands">
<h2>Step 4: Create screen-specific commands<a class="headerlink" href="#step-4-create-screen-specific-commands" title="Permalink to this headline">¶</a></h2>
<p>If an app has several screens, it may be necessary to create voice commands that will work for specific screens only. In Alan AI, you can create screen-specific commands with the help of
<a class="reference internal" href="../../../server-api/sending-data/visual-state/#filtering-commands"><span class="std std-ref">filters</span></a> added to intents. The filter in an intent defines conditions in which
the intent can be matched. In our case, we can use information about the open screen as the filter.</p>
<p>Let’s modify our navigation commands to apply filters to them. The filter comes as the first parameter in the intent. In Alan AI Studio, update the intents to the following:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Dialog script</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-alan notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nv">firstScreen = </span><span class="kp">visual</span><span class="p">(</span><span class="nx">state</span> <span class="p">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">screen</span> <span class="o">===</span> <span class="s2">"first"</span><span class="p">);</span>

<span class="kp">intent</span><span class="p">(</span><span class="nx">firstScreen</span><span class="p">,</span> <span class="s1">'Open the second screen'</span><span class="p">,</span> <span class="nx">p</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">({</span><span class="nv">command: </span><span class="s1">'forward'</span><span class="p">});</span>
    <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'Opening the second screen'</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nv">secondScreen = </span><span class="kp">visual</span><span class="p">(</span><span class="nx">state</span> <span class="p">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">screen</span> <span class="o">===</span> <span class="s2">"second"</span><span class="p">);</span>

<span class="kp">intent</span><span class="p">(</span><span class="nx">secondScreen</span><span class="p">,</span> <span class="s1">'Go back'</span><span class="p">,</span> <span class="nx">p</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">({</span><span class="nv">command: </span><span class="s1">'back'</span><span class="p">});</span>
    <span class="k k-Alan">p.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'Going back'</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>You can test it: run the app and say: <code class="docutils literal notranslate"><span class="pre">Go</span> <span class="pre">back</span></code>. Alan AI will not be able to match this intent. This intent will be matched only if the second screen is open.</p>
</div>
<div class="section" id="what-s-next">
<h2>What’s next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>Have a look at the next tutorial: <a class="reference internal" href="../project-api-flutter/"><span class="doc">Sending data to the dialog script</span></a>.</p>
</div>
</div>

      </article>
	  <div class="alan-btn"></div>
	  <script>
		function isLocalStorageAvailable() {
            var result;

            try {
                localStorage.setItem('test', 1);
                localStorage.getItem('test');
                localStorage.removeItem('test');
                result = true;
            } catch (e) {
                result = false;
            }
            return result;
        }

        function getProjectId() {
            var key = 'beae1a6e1f7e512c4d0bf347580da6fd2e956eca572e1d8b807a3e2338fdd0dc/prod';
            if (key) {
                return key.substr(0, key.indexOf('/'));
            }

            return null;
        }

        console.info("Alan Lib is laoded.");
        window.alanBtnInstance = window.alanBtn({
            key: 'beae1a6e1f7e512c4d0bf347580da6fd2e956eca572e1d8b807a3e2338fdd0dc/prod',
            zIndex: 999999,
            onCommand: function (commandData) {

                if (commandData && commandData.command === 'openURL') {
                    if (commandData.target === '_blank'){
                        window.open(commandData.url,'_newtab' + Math.floor(Math.random()*999999));
                    } else {
                        window.location.href = commandData.url;
                    }

                }
            },
            onConnectionStatus: function (status) {
                if (status === 'authorized') {
                    window.alanBtnInstance.setVisualState({ page: window.location.pathname, url: window.location.href });
                    if(isLocalStorageAvailable()){
                        if(!localStorage.getItem('alan-btn-session-'+ getProjectId())) {
                            localStorage.setItem('alan-btn-session-'+ getProjectId(), 1)
                            window.alanBtnInstance.callProjectApi("sendGreetingMessage");
                        }
                    }
                }
            },
        });
	  </script>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        
	  <div class="alan-footer">
	  <div class="footer-logo-and-social-icons">
		<div class="footer-logo-and-text">
		<a class="footer-logo" aria-label="Link to alan.app" href="https://alan.app/"></a>
		</div>
		<div class="footer-text">
		<span>Alan AI<sup>®</sup> is a trademark of Alan AI, Inc.</span>
		<span>Handcrafted in Sunnyvale, California</span>
		</div>
		<div class="footer-other">
		<div class="footer-social">
			<a href="https://twitter.com/alanvoiceai" target="_blank" class="fa-brands fa-twitter"></a>
			<a href="http://linkedin.com/company/alanvoiceai" target="_blank" class="fa-brands fa-linkedin"></a>
			<a href="https://www.facebook.com/alanvoiceai/" target="_blank" class="fa-brands fa-facebook"></a>
			<a href="https://www.instagram.com/alanvoiceai/" target="_blank" class="fa-brands fa-instagram"></a>
			<a href="https://www.youtube.com/channel/UCrsg0b32nL6L2j5jG7uxOuw" target="_blank" class="fa-brands fa-youtube"></a>
			<a href="https://alanaigroup.slack.com/join/shared_invite/enQtNzMzOTE5MTIwMjg4LWI4ZmM4MTNkMTdmY2M0ZWEwODlmZDQ5Y2ZkMjUzNmMyZDJiMzA0Y2M1NDdhYzZjYWFlZTA5NjM4OTU0MWFmNWU#/shared-invite/email" target="_blank" class="fa-brands fa-slack"></a>
			<a href="https://github.com/alan-ai" target="_blank" class="fa-brands fa-github"></a>
        </div>
		</div>
	  </div>
	  <div class="footer-badges">
	  <div class="footer-badges-info">
	  <div class="footer-badges-info-icon"></div>
	  <div>Download Alan Playground to see how Conversational Voice Experiences can add value to your application or test your Alan Studio Projects.</div>
	  </div>
	  
	  </div>
	  <div class="footer-badges-imgs">
	  <a class="footer_badges_imgs_app-store" href="https://apps.apple.com/ca/app/alan-playground/id1474478921"></a>
	  <a class="footer_badges_imgs_google-play" href="https://play.google.com/store/apps/details?id=app.alan.playground"></a>
	  </div>
	  
	  </div>
	  
      </footer>
	
    </div>
	
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Passing the app state to the dialog script (Flutter)</a><ul>
<li><a class="reference internal" href="#what-you-will-learn">What you will learn</a></li>
<li><a class="reference internal" href="#what-you-will-need">What you will need</a></li>
<li><a class="reference internal" href="#step-1-add-routeobserver">Step 1. Add RouteObserver</a></li>
<li><a class="reference internal" href="#step-2-send-the-app-state-to-the-dialog-script">Step 2: Send the app state to the dialog script</a></li>
<li><a class="reference internal" href="#step-3-add-a-voice-command-with-different-answers-for-screens">Step 3: Add a voice command with different answers for screens</a></li>
<li><a class="reference internal" href="#step-4-create-screen-specific-commands">Step 4: Create screen-specific commands</a></li>
<li><a class="reference internal" href="#what-s-next">What’s next?</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  
  </main>
</div>
</div>

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/custom.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@latest/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/scripts/algolia.js"></script>
    <script defer="defer" src="../../../_static/scripts/algolia-mobile.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>